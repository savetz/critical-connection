1  *=$700
2 START=*
3  .BYTE 0
4  .BYTE 7
5  .WORD START
6  .WORD LINE1
20 LINE1 LDA #9
30  STA ICCOM
40  LDA #HELLO&255
50  STA ICBAL
60  LDA #HELLO/256
70  STA ICBAH
80  LDA #255
90  STA ICBLL
0100  STA ICBLH
0110  LDX #0
0120  JSR CIOV   ; PRINT
0130  LDA #5
0140  STA ICCOM
0150  LDA #DKBUF&255
0160  STA ICBAL
0170  LDA #DKBUF/256
0180  STA ICBAH
0190  LDA #255
0200  STA ICBLL
0210  STA ICBLH
0220  LDX #0
0230  JSR CIOV   ; INPUT
0240  LDA #0
0250  STA DAUX1
0260  STA DAUX2
0270  INC DAUX1
0280 COPYLOOP LDA DAUX1
0290  STA DAUX1C
0300  LDA DAUX2
0310  STA DAUX2C
0320  JSR DKSETUP
0330  LDA #1
0340  STA BUFPNT
0350 INLOOP LDA #1
0360  STA $301    ; DISK 1
0370  JSR GETSEC
0380  LDA #0      ; ASSUME GOOD
0390  LDX DAUX1
0400  CPY #1
0410  BEQ OKSEC
0420  JMP NOWTAB       ; LDA #'B'    ; WAS A BAD SECTOR
0430 OKSEC STA BADSECS,X
0440  LDA #18
0450  CMP BUFPNT
0460  BEQ SENDBUF
0470  JSR ADD128
0480  JSR READINC
0520  JMP INLOOP
0530 SENDBUF JSR  DKSETUP
0540  LDA #1
0550  STA BUFPNT
0560  LDA #2
0570  STA $301   ; DISK 2
0580  LDA DAUX1C
0590  STA DAUX1
0600  LDA DAUX2C
0610  STA DAUX2
0620 OUTLOOP JSR PUTSEC
0630  CPY #1
0640  BNE OUTLOOP
0650  LDA #18
0660  CMP BUFPNT
0670  BEQ COPYLOOP
0680  JSR INCSEC
0690  JSR ADD128
0700  LDA #2
0710  CMP DAUX2
0720  BNE OUTLOOP
0730  LDA #208
0740  CMP DAUX1
0750  BNE OUTLOOP
0760  JSR WRITETAB
0770  JMP SAYDONE
0780 SKIPTRAK LDA #18
0790  CMP BUFPNT
0800  BEQ SENDBUF
0810  JSR ADD128
0820  JSR READINC
0860 NOWTAB LDX DAUX1
0870  LDA #'B'
0880  STA BADSECS,X
0890  JMP SKIPTRAK
0900 WRITETAB LDA $304
0910  STA THREE4
0920  LDA $305
0930  STA THREE5
0940  LDA #BADSECS&255
0950  STA $304
0960  LDA #BADSECS/256
0970  STA $305
0980  LDA DAUX1
0990  STA TMPAUX1
1000  LDA DAUX2
1010  STA TMPAUX2
1020  LDA #2
1030  STA $301
1040  STA DAUX2
1050  LDA LOWBADN
1060  STA DAUX1
1070  JSR PUTSEC    ; 
1080  INC LOWBADN
1090  LDA #SECNDHF&255
1100  STA $304
1110  LDA #SECNDHF/256
1120  STA $305
1130  LDA #2
1140  STA $301
1150  LDA #2
1160  STA DAUX2
1170  LDA LOWBADN
1180  STA DAUX1
1190  JSR PUTSEC    ; 
1200  INC LOWBADN
1210  LDA TMPAUX1
1220  STA DAUX1
1230  LDA TMPAUX2
1240  STA DAUX2
1250  LDA THREE4
1260  STA $304
1270  LDA THREE5
1280  STA $305
1290  RTS
1300 THREE4 .BYTE 0
1310 THREE5 .BYTE 0
1320 SAYDONE LDA #9
1330  STA ICCOM
1340  LDA #MSG&255
1350  STA ICBAL
1360  LDA #MSG/256
1370  STA ICBAH
1380  LDA #255
1390  STA ICBLL
1400  STA ICBLH
1410  LDX #0
1420  JSR CIOV
1430 DONE JMP DONE
1440 LOWBADN .BYTE 209
1450 DKSETUP LDA #DKBUF&255 ; SET BUFFER ADDRESS TO DKBUF
1460  STA $304
1470  LDA #DKBUF/256
1480  STA $305
1490  LDA #1
1500  STA $301
1510  RTS
1520 GETSEC LDA #'R'
1530  STA DCOMND
1540  JMP DSKIF
1550 PUTSEC LDA #'W'          ; W FOR WRITE 128
1560  STA DCOMND
1570  JMP DSKIF
1580 RET LDY #SUCCES
1590 RETURN RTS
1600 DCOMND=$302
1610 DAUX1=$30A
1620 DAUX2=$30B
1630 DSKIF=$E453
1640 SUCCES=1
1650 ICCOM=$342
1660 ICBAL=$344
1670 ICBAH=$345
1680 ICBLL=$348
1690 ICBLH=$349
1700 CIOV=$E456
1710 TMPAUX1 .BYTE 0
1720 TMPAUX2 .BYTE 0
1730 MSG .BYTE "I AM DONE NOW",$9B
1740 HELLO .BYTE "To COPY бощ DISK onto the CPM system: "
1750  .BYTE "Plug the CPM/ATARI CONNECTION into the"
1760  .BYTE "back of drive 1 with drive 1 plugged  "
1770  .BYTE "into the ATARI.  Turn on drive 1 and  "
1780  .BYTE "put in the diskette.                  "
1790  .BYTE "Use the V option on the CPM system.   "
1800  .BYTE "Answer 2 when the CPM system asks what"
1810  .BYTE "drive you want it to be.              "
1820  .BYTE "When all this is done hit RETURN."
1830  .BYTE $9B
1840 ADD128 INC BUFPNT
1850  LDA #128
1860  CLC
1870  ADC $304
1880  BCS INRHIGH
1890  STA $304
1900  RTS
1905 READINC JSR INCSEC ; when daux1 goes to 0 on read write out table
1906  LDA DAUX1
1907  BNE RETN
1908  JSR WRITETAB
1909 RETN RTS
1910 INRHIGH STA $304
1920  INC $305
1930  RTS
1940 INCSEC INC DAUX1
1950  BEQ NEXT256
1960  RTS 
1970 NEXT256 INC DAUX2
1980  RTS
1990 BUFPNT .WORD 0
2000 DAUX1C .BYTE 0
2010 DAUX2C .BYTE 0
2020 BADSECS *=*+128
2030 SECNDHF *=*+129
2040 DKBUF .WORD  0
2050 PND .END
