10  *=$3000
20 PINIT LDA #TAB&255
30  STA $321
40  LDA #TAB/256
50  STA $322
60  .BYTE 0
70 TAB .WORD OPEN-1
80  .WORD CLOSE-1
90  .WORD GETBYTE-1
0100  .WORD PUTBYTE-1
0110  .WORD STAT-1
0120  .WORD RET-1    ; XIO
0130  JMP RET        ; INIT
0140 STAT JMP RET
0150 STATMA LDA #$53 ;STAT MINUS AUX
0160  STA DCOMND
0162  LDA #1
0163  STA $301
0170  JMP DSKIF      ; RETURN FROM THERE
0180 DAUX2=$30B
0190 DAUX1=$30A
0200 DCOMND=$302
0210 DSKIF=$E453
0220 OPEN LDA #0
0230  STA DAUX1
0240  JMP   $F3FC
0250 CLOSE JMP RET
0260 GETBYTE JSR SWAP
0270  JSR ERANGE
0280  LDA BUFCNT
0290  BNE EGETC3
0300  LDA ROWCRS
0310  STA BUFSTR
0320  LDA COLCRS
0330  STA BUFSTR+1
0340 EGETC1 JSR KGETCH
0350  STY DSTAT
0360  LDA ATACHR
0370  CMP #$9B
0380  BEQ EGETC2
0390  JSR DOSS
0400  JSR SWAP
0410  LDA LOGCOL
0420  CMP #113
0430  BNE EGETC6
0440  JSR BELL
0450 EGETC6 JMP EGETC1
0460 EGETC3 JMP $F67C
0470 EGETC2 JMP $F66E
0480 KGETCH LDA #'K'
0490  STA DAUX2
0500  JSR STATMA
0510  CPY #SUCCES
0520  BNE KGETCH
0530  LDA VSERIN
0540  STA VECTMP
0550  LDA VSERIN+1
0560  STA VECTMP+1
0570  LDA #MYSIN&255
0580  STA VSERIN
0590  LDA #MYSIN/256
0600  STA VSERIN+1
0602  LDA #1
0603  STA CRITIC
0610  JSR RECVEN
0620 SPIN LDY DONEFLAG
0630  CPY #$FF
0640  BEQ ADONE
0650  LDY CHARNUM
0660  CPY #0
0670  BEQ SPIN
0680  INC TIMEOUT
0690  BEQ TRANERR
0700  JMP SPIN
0710 ADONE STA CHARHIT
0720  LDA #0
0730  STA DONEFLAG
0740  LDA CHARNUM
0750  BEQ FIRSTCH
0760  LDA CHAR1
0770  CMP CHARHIT
0780  BNE TRANERR
0790  JSR INOFF
0800  LDA CHARHIT
0810  STA ATACHR
0820  JMP RET
0830 FIRSTCH LDA CHARHIT
0840  STA CHAR1
0850  INC CHARNUM
0860  JMP SPIN
0870 TRANERR JSR INOFF
0880  LDA #'R'
0890  STA DAUX1
0900  JMP KGETCH
0910 VSERIN = $20A
0920 SERIN = $D20D
0930 POKMSK = $10
0940 CHARHIT .BYTE 0
0950 MYSIN PLA   ; WHAT WAS IN A DURING SPIN
0960  LDA #$FF
0970  STA DONEFLAG
0980  LDA SERIN
0990  RTI
1000 RET LDY #SUCCES
1010  RTS
1020 SUCCES=1
1030 DONEFLAG .BYTE 0
1040 VECTMP .WORD 0000
1050 POKMSKTP .BYTE 0
1060 RECVEN = $EC1F ;;LDA #7   ;;$EC1F
1070  AND SSKCTL
1080  ORA #$10
1090  STA SSKCTL
1100  STA SKCTL
1110  STA SKRES
1120  LDA #$C7
1130  AND POKMSK
1140  ORA #$20
1150  STA POKMSK
1160  STA IRQEN
1170  RTS
1180 RECVDS = $EC63 ;; LDA #$C7    ;;$EC63
1190  AND POKMSK
1200  STA POKMSK
1210  STA IRQEN
1220  LDX #6
1230  LDA #0
1240 ZERIT STA AUDC1,X
1250  DEX
1260  DEX
1270  BPL ZERIT
1280  RTS
1290 SKSTAT = $D20F
1300 PUTBYTE=$F6A4
1310 SWAP=$FCB3
1320 ERANGE=$FA88
1330 BUFCNT=$006B
1340 ROWCRS = $0054
1350 BUFSTR=$006C
1360 COLCRS=$0055
1370 DSTAT=$004C
1380 ATACHR=$2FB
1390 DOSS=$F6AD
1400 LOGCOL=$0063
1410 BELL=$F90A
1420 CRITIC=$42
1430 SSKCTL=$232
1440 SKCTL=$D20F
1450 SKRES=$D20A
1460 AUDC1=$D201
1470 IRQEN=$D20E
1480 CHAR1 .BYTE 0
1490 CHARNUM .BYTE 0
1500 TIMEOUT  .BYTE 0
1510 INOFF JSR RECVDS
1520  LDA VECTMP
1530  STA VSERIN
1540  LDA VECTMP+1
1550  STA VSERIN+1
1560  LDA #0
1570  STA CHAR1
1580  STA DAUX1
1590  STA CHARNUM
1600  STA DONEFLAG
1605  STA CRITIC
1610  RTS
1620 PND .END
