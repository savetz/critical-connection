0400  *=$3000
0410 PINIT LDA #$57
0420  STA $32C
0430  LDA #TAB&255
0440  STA $32D
0450  LDA #TAB/256
0460  STA $32E
0470  .BYTE 0
0480 TAB .WORD OPEN-1
0490  .WORD CLOSE-1
0500  .WORD GETBYTE-1
0510  .WORD PUTBYTE-1
0520  .WORD STAT-1
0530  .WORD RET-1    ; XIO
0540  JMP RET        ; INIT
0550 STAT LDA #'S'   ; S FOR STATUS
0560  STA DAUX1
0570 STATMA LDA #$53 ;STAT MINUS AUX
0580  STA DCOMND
0590  JMP DSKIF      ; RETURN FROM THERE
0600 DCOMND=$302
0610 DAUX1=$30A
0615 DAUX2=$30B
0620 DSKIF=$E453
0630 OPEN JSR DKSETUP
0640  LDA #'O'       ; O FOR OPEN
0650  STA DAUX2
0660  STX IOCBNUM
0670  LDA $344,X       ; POINTER TO FILE NAME 
0680  STA $304
0690  LDA $345,X
0700  STA $305
0710  JSR DBUFFL     ; SEND FILE NAME 
0715  LDA #0
0716  STA DAUX1      ; Is incemented as sectors fly
0720 DKSETUP LDA #DKBUF&255 ; SET BUFFER ADDRESS TO DKBUF
0730  STA $304
0740  LDA #DKBUF/256
0750  STA $305
0760  LDA #1
0770  STA $301
0780  LDA #'X'            ; NOT OPEN
0790  STA DAUX2
0795  INC DAUX1      ; new sector
0800  RTS
0810 IOCBNUM .BYTE 0     ; IOCB NUMBER TIMES 16
0820 HOWUSED .BYTE 0
0830 CLOSE LDA HOWUSED
0840  CMP #'R'            ; R = READ
0850  BEQ DONECLOS        ; JMP NOT WRITE
0860 CLOSEL LDA #$1A
0870  JSR PUTBYTE
0880  LDX DKBPNT
0890  CPX #0
0900  BNE CLOSEL
0910 DONECLOS LDA #'C'  ; C FOR CLOSE
0920  STA DAUX2
0930  JMP DBUFFL     ; SEND 128 but use none
0940 GETBYTE LDY #'R'
0950  STY HOWUSED
0960  LDX DKBPNT
0970  CPX #0
0980  BNE ISAB
0990  LDA #'R'
1000  STA DCOMND
1010  JSR DKSETUP
1020  JSR DSKIF
1025  CPY #SUCCES
1026  BNE RETURN
1030 ISAB LDX DKBPNT
1040  LDA DKBUF,X
1050  INX
1060  CPX #128
1070  BNE SETDBPNT
1080  LDX #0            ; IF IT WAS 128 MAKE IT 0
1090 SETDBPNT STX DKBPNT
1100  JSR WHATTYPE
1110  CPY #7          ; GET BINARY
1120  BEQ RET
1130  CMP #$1A
1140  BEQ EOF
1150  CMP #$0D
1160  BEQ GETBYTE
1170  CMP #$0A
1180  BNE RET
1190  LDA #$9B
1200 RET LDY #SUCCES
1210 RETURN RTS
1220 EOF LDY #$88
1230  RTS
1240 WHATTYPE LDY $A051
1241  LDX IOCBNUM
1242  CPY #$45
1244  BEQ ASMEDIT
1245  LDY $342,X
1260  RTS
1262 ASMEDIT CPX #$20
1264  BEQ OBJCODE
1265  LDY #$3
1266  RTS
1267 OBJCODE LDY #11
1268  RTS
1270 EOL LDA #$0D
1280  JSR PUTBYTE
1290  LDA #$0A            ; ON END OF LINE CPM NEEDS 2 CHARS
1300 PUTBYTE LDY #'W'      ; W= WRITE
1310  STY HOWUSED
1320  JSR WHATTYPE
1330  CPY #11         ; PUT BINARY
1340  BEQ PUTLIT
1350  CMP #$9B
1360  BEQ EOL
1370 PUTLIT LDX DKBPNT
1380  STA DKBUF,X
1390  INX
1400  CPX #128
1410  BNE NOTFUL        ; WE WILL WAIT FOR FULL 128
1420  JSR DKSETUP
1430 DBUFFL  LDA #'W'          ; W FOR WRITE 128
1440  STA DCOMND
1450  JSR DSKIF
1455  CPY #SUCCES
1456  BNE RETURN
1460  LDX #0            ; NOW BUFFER EMPTY
1470 NOTFUL STX DKBPNT
1480  LDY #SUCCES
1490  RTS
1500 DKBPNT .BYTE 0
1510 SUCCES=1
1520 DKBUF .WORD  0
1530 PND .END